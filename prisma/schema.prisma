generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model Vendor {
  id            String         @id @default(uuid())
  phoneNumber   String         @unique
  businessName  String?
  password      String?        // [MODIFIED] Optional for OTP-based auth
  language      String?        @default("English")
  createdAt     DateTime       @default(now())
  updatedAt     DateTime       @updatedAt
  
  subscription  Subscription?
  vendorPreference VendorPreference?
  customers     Customer[]
  transactions  Transaction[]
  devices       Device[]
}

model Customer {
  id           String        @id @default(uuid())
  name         String?
  phoneNumber  String?
  vendorId     String
  balance      Float         @default(0.0)
  createdAt    DateTime      @default(now())
  updatedAt    DateTime      @updatedAt
  
  vendor       Vendor        @relation(fields: [vendorId], references: [id])
  transactions Transaction[]
  
  @@unique([vendorId, phoneNumber])
}

model Transaction {
  id          String   @id @default(uuid())
  amount      Float
  type        String   // CREDIT or DEBIT/PAYMENT
  description String?
  date        DateTime @default(now())
  vendorId    String
  customerId  String
  
  vendor      Vendor   @relation(fields: [vendorId], references: [id])
  customer    Customer @relation(fields: [customerId], references: [id])
}

model Subscription {
  id        String   @id @default(uuid())
  vendorId  String   @unique
  planType  String   // TRIAL, MONTHLY, YEARLY
  status    String   // ACTIVE, EXPIRED
  startDate DateTime @default(now())
  endDate   DateTime
  
  vendor    Vendor   @relation(fields: [vendorId], references: [id])
}

model Otp {
  id        String   @id @default(uuid())
  phone     String   @unique
  code      String
  expiresAt DateTime
  createdAt DateTime @default(now())
}

model PricingPlan {
  id          String   @id @default(uuid())
  name        String   @unique // e.g., "starter", "professional", "business"
  price       Float    // e.g., 99, 199, 499
  interval    String   @default("month") // "month", "year"
  description String?
  features    String?  @db.Text // JSON string or comma-separated
  isActive    Boolean  @default(true)
  updatedAt   DateTime @updatedAt
  createdAt   DateTime @default(now())
}

model NotificationLog {
  id        String   @id @default(cuid())
  vendorId  String
  type      String   // SUMMARY, RISK, REMINDER, SYSTEM
  title     String
  body      String
  sentAt    DateTime @default(now())
  metadata  Json?
}

model VendorPreference {
  id               String   @id @default(cuid())
  vendorId         String   @unique
  quietMode        Boolean  @default(false)
  quietStart       String?  // "22:00"
  quietEnd         String?  // "07:00"
  enabledCategories Json    // ["SUMMARY", "RISK", "REMINDER", "SYSTEM", "INACTIVITY", "PROMO"]
  createdAt        DateTime @default(now())
  updatedAt        DateTime @updatedAt
  
  vendor           Vendor   @relation(fields: [vendorId], references: [id])
}

model PushCampaign {
  id          String   @id @default(cuid())
  title       String
  body        String
  target      String   // ALL, PAID, FREE, INACTIVE
  status      String   // DRAFT, SCHEDULED, SENT, CANCELLED
  scheduledAt DateTime?
  sentAt      DateTime?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  metadata    Json?
}

model Device {
  id        String   @id @default(cuid())
  vendorId  String
  token     String   @unique // FCM Token
  platform  String   // android, ios
  lastActive DateTime @default(now())
  createdAt DateTime @default(now())
  
  vendor    Vendor   @relation(fields: [vendorId], references: [id])
}
